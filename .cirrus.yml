container:
  image: ubuntu:18.04

env:
  VERSION: 1.0
  GITHUB_TOKEN: ENCRYPTED[c61ae1dde3292c0b91206d9767bb761cc546665cf66f33edf2c97697aa14d323337a84902770e3890c53ca7bfc628779]

task:
  only_if: $CIRRUS_BRANCH == "master"

  timeout_in: 90m

  install_apt_script: |
    apt-get update
    apt-get -y install wget curl make gcc file g++ patch cpio python unzip rsync bc libdata-dumper-simple-perl libextutils-makemaker-cpanfile-perl libthread-queue-any-perl jq zip
  
  ccache_cache:
    folder: /tmp/buildroot-ccache
  
  build_script: ./build.sh

  publish_script: ./publish.sh "./build/output/images/sdcard.img" $VERSION
